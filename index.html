<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetID - Evcil Hayvan Kimlik Sistemi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .pet-card {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .stat-card {
            background: linear-gradient(145deg, #f8fafc, #e2e8f0);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        /* Enhanced Mobile Optimization */
        @media (max-width: 768px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            .text-4xl {
                font-size: 2rem;
            }
            
            .text-3xl {
                font-size: 1.5rem;
            }
            
            .text-2xl {
                font-size: 1.25rem;
            }
            
            .p-8 {
                padding: 1.5rem;
            }
            
            .p-6 {
                padding: 1rem;
            }
            
            .space-x-8 > * + * {
                margin-left: 1rem;
            }
            
            .grid-cols-4 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
            
            .max-w-6xl {
                max-width: 100%;
            }
            
            .overflow-x-auto {
                -webkit-overflow-scrolling: touch;
            }
        }
        
        @media (max-width: 480px) {
            .text-xl {
                font-size: 1.125rem;
            }
            
            .px-8 {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            .py-3 {
                padding-top: 0.5rem;
                padding-bottom: 0.5rem;
            }
            
            .space-x-4 > * + * {
                margin-left: 0.5rem;
            }
            
            .grid-cols-2 {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }
        }
        
        /* Touch-friendly buttons */
        button, .button {
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Better tap targets */
        a, button, input, select, textarea {
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
        }
        
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
        
        /* Better form inputs on mobile */
        input, textarea, select {
            font-size: 16px; /* Prevents zoom on iOS */
        }
    </style>
</head>
<body class="bg-gray-50 min-h-full">
    <!-- Navigation -->
    <nav class="gradient-bg text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold">ğŸ¾ PetID</h1>
            <div class="flex space-x-2 md:space-x-4">
                <button onclick="showLogin()" class="bg-white text-purple-600 px-3 md:px-4 py-2 rounded-lg text-sm md:text-base font-medium hover:bg-gray-100 transition">GiriÅŸ</button>
                <button onclick="showRegister()" class="bg-purple-800 px-3 md:px-4 py-2 rounded-lg text-sm md:text-base font-medium hover:bg-purple-900 transition">KayÄ±t</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto p-6">
        <!-- Welcome Section -->
        <div id="welcomeSection" class="text-center py-8 md:py-12 px-4">
            <h2 class="text-2xl md:text-4xl font-bold text-gray-800 mb-4">ğŸ¾ KayÄ±p Hayvan Bulma Sistemi</h2>
            <p class="text-lg md:text-xl text-gray-600 mb-4">NFC Teknolojisi ile Evcil HayvanÄ±nÄ±zÄ± Koruyun</p>
            <p class="text-base md:text-lg text-gray-500 mb-8">HayvanÄ±nÄ±z kaybolduÄŸunda bulan kiÅŸi tasmasÄ±ndaki NFC'yi okutarak size anÄ±nda ulaÅŸabilir</p>
            
            <!-- Emergency Scenario -->
            <div class="bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 rounded-lg p-6 mb-6 max-w-3xl mx-auto">
                <h3 class="text-lg font-bold text-red-800 mb-4">ğŸš¨ KayÄ±p Hayvan Senaryosu</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-left">
                    <div class="space-y-3">
                        <div class="flex items-start">
                            <span class="text-2xl mr-3">ğŸ˜°</span>
                            <div>
                                <div class="font-medium text-red-800">HayvanÄ±nÄ±z Kayboldu</div>
                                <div class="text-sm text-red-600">Panik yapmayÄ±n, sistem devreye giriyor</div>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <span class="text-2xl mr-3">ğŸ‘¤</span>
                            <div>
                                <div class="font-medium text-red-800">Biri HayvanÄ±nÄ±zÄ± Buldu</div>
                                <div class="text-sm text-red-600">TasmasÄ±ndaki NFC'yi telefonuyla okutuyor</div>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div class="flex items-start">
                            <span class="text-2xl mr-3">ğŸ“±</span>
                            <div>
                                <div class="font-medium text-red-800">AnÄ±nda Bilgilere EriÅŸim</div>
                                <div class="text-sm text-red-600">Hayvan profili ve iletiÅŸim bilgileriniz gÃ¶rÃ¼nÃ¼r</div>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <span class="text-2xl mr-3">ğŸ“</span>
                            <div>
                                <div class="font-medium text-red-800">Siz Haberdar Oluyorsunuz</div>
                                <div class="text-sm text-red-600">Kim okutuyor, nerede - hepsini anlÄ±k takip</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- How It Works -->
            <div class="bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-6 mb-8 max-w-2xl mx-auto">
                <h3 class="text-lg font-bold text-purple-800 mb-4">ğŸš€ NasÄ±l Ã‡alÄ±ÅŸÄ±r?</h3>
                <div class="space-y-3">
                    <div class="flex items-start">
                        <span class="text-2xl mr-3">1ï¸âƒ£</span>
                        <div>
                            <div class="font-medium text-purple-800">Ãœye Olun</div>
                            <div class="text-sm text-purple-600">Ãœcretsiz hesap oluÅŸturun</div>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <span class="text-2xl mr-3">2ï¸âƒ£</span>
                        <div>
                            <div class="font-medium text-purple-800">Hayvan Bilgilerini Kaydedin</div>
                            <div class="text-sm text-purple-600">FotoÄŸraf, iletiÅŸim, saÄŸlÄ±k bilgileri</div>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <span class="text-2xl mr-3">3ï¸âƒ£</span>
                        <div>
                            <div class="font-medium text-purple-800">NFC Tag'a Link YÃ¼kleyin</div>
                            <div class="text-sm text-purple-600">Ã–zel linkinizi NFC etiketine yazÄ±n</div>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <span class="text-2xl mr-3">4ï¸âƒ£</span>
                        <div>
                            <div class="font-medium text-purple-800">AnlÄ±k Takip</div>
                            <div class="text-sm text-purple-600">Kim okutuyor, nerede - canlÄ± konum takibi</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex flex-col md:flex-row justify-center items-center space-y-4 md:space-y-0 md:space-x-8 mb-8">
                <div class="text-center">
                    <div class="text-3xl md:text-4xl mb-2">ğŸ“±</div>
                    <p class="text-sm text-gray-600">NFC Tag</p>
                </div>
                <div class="text-xl md:text-2xl text-gray-400 rotate-90 md:rotate-0">â†’</div>
                <div class="text-center">
                    <div class="text-3xl md:text-4xl mb-2">ğŸ¾</div>
                    <p class="text-sm text-gray-600">Dijital Profil</p>
                </div>
                <div class="text-xl md:text-2xl text-gray-400 rotate-90 md:rotate-0">â†’</div>
                <div class="text-center">
                    <div class="text-3xl md:text-4xl mb-2">ğŸ“</div>
                    <p class="text-sm text-gray-600">HÄ±zlÄ± Ä°letiÅŸim</p>
                </div>
            </div>
            

            
            <div class="space-y-4">
                <button onclick="showRegister()" class="bg-purple-600 text-white px-6 md:px-8 py-3 rounded-lg text-base md:text-lg font-medium hover:bg-purple-700 transition w-full max-w-xs">Hemen BaÅŸla</button>
                
                <!-- Demo Link -->
                <div class="bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4 max-w-md mx-auto">
                    <h4 class="font-bold text-green-800 mb-2">ğŸ¯ Demo Deneyin!</h4>
                    <p class="text-sm text-green-700 mb-3">Sistemi test etmek iÃ§in demo hayvan profilini gÃ¶rÃ¼ntÃ¼leyin:</p>
                    <button onclick="window.location.hash = '#pet=2001'" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition text-sm w-full">Demo Profili GÃ¶rÃ¼ntÃ¼le</button>
                </div>
            </div>
        </div>

        <!-- Login Form -->
        <div id="loginForm" class="hidden max-w-md mx-auto bg-white p-8 rounded-xl card-shadow">
            <h3 class="text-2xl font-bold text-center mb-6">GiriÅŸ Yap</h3>
            <form onsubmit="login(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">E-posta</label>
                    <input type="email" id="loginEmail" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Åifre</label>
                    <input type="password" id="loginPassword" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" required>
                </div>
                <button type="submit" class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition">GiriÅŸ Yap</button>
            </form>
            <p class="text-center mt-4 text-gray-600">HesabÄ±nÄ±z yok mu? <button onclick="showRegister()" class="text-purple-600 hover:underline">KayÄ±t olun</button></p>
        </div>

        <!-- Register Form -->
        <div id="registerForm" class="hidden max-w-md mx-auto bg-white p-8 rounded-xl card-shadow">
            <h3 class="text-2xl font-bold text-center mb-6">KayÄ±t Ol</h3>
            <form onsubmit="register(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Ad Soyad</label>
                    <input type="text" id="registerName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">E-posta</label>
                    <input type="email" id="registerEmail" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Telefon</label>
                    <input type="tel" id="registerPhone" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Åifre</label>
                    <input type="password" id="registerPassword" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" required>
                </div>
                <button type="submit" class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition">KayÄ±t Ol</button>
            </form>
            <p class="text-center mt-4 text-gray-600">Zaten hesabÄ±nÄ±z var mÄ±? <button onclick="showLogin()" class="text-purple-600 hover:underline">GiriÅŸ yapÄ±n</button></p>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 md:mb-8 space-y-4 md:space-y-0">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Kontrol Paneli</h2>
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4 w-full md:w-auto">
                    <button onclick="showAddPet()" class="bg-purple-600 text-white px-4 md:px-6 py-2 rounded-lg hover:bg-purple-700 transition text-sm md:text-base">+ Hayvan Ekle</button>
                    <button onclick="logout()" class="bg-gray-500 text-white px-4 md:px-6 py-2 rounded-lg hover:bg-gray-600 transition text-sm md:text-base">Ã‡Ä±kÄ±ÅŸ</button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="stat-card p-6 rounded-xl">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">ğŸ•</div>
                        <div>
                            <p class="text-gray-600">Toplam Hayvan</p>
                            <p class="text-2xl font-bold" id="totalPets">0</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card p-6 rounded-xl">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">ğŸ‘ï¸</div>
                        <div>
                            <p class="text-gray-600">Toplam GÃ¶rÃ¼ntÃ¼lenme</p>
                            <p class="text-2xl font-bold" id="totalViews">0</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card p-6 rounded-xl">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">ğŸ“</div>
                        <div>
                            <p class="text-gray-600">Arama TÄ±klamasÄ±</p>
                            <p class="text-2xl font-bold" id="totalCalls">0</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card p-6 rounded-xl">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">ğŸ“</div>
                        <div>
                            <p class="text-gray-600">Konum GÃ¶rÃ¼ntÃ¼leme</p>
                            <p class="text-2xl font-bold" id="totalLocations">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pet List -->
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h3 class="text-xl font-bold mb-4">HayvanlarÄ±m</h3>
                <div id="petList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Pet cards will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Add Pet Form -->
        <div id="addPetForm" class="hidden max-w-6xl mx-auto bg-white rounded-xl card-shadow">
            <div class="flex justify-between items-center p-6 border-b">
                <h3 class="text-2xl font-bold">Yeni Hayvan Profili OluÅŸtur</h3>
                <button onclick="hideForms()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <!-- Tab Navigation -->
            <div class="flex border-b overflow-x-auto">
                <button onclick="switchTab('media')" id="mediaTab" class="px-3 md:px-6 py-3 border-b-2 border-purple-600 text-purple-600 font-medium text-sm md:text-base whitespace-nowrap">Medya</button>
                <button onclick="switchTab('basic')" id="basicTab" class="px-3 md:px-6 py-3 text-gray-600 hover:text-purple-600 font-medium text-sm md:text-base whitespace-nowrap">Temel</button>
                <button onclick="switchTab('health')" id="healthTab" class="px-3 md:px-6 py-3 text-gray-600 hover:text-purple-600 font-medium text-sm md:text-base whitespace-nowrap">SaÄŸlÄ±k</button>
                <button onclick="switchTab('contact')" id="contactTab" class="px-3 md:px-6 py-3 text-gray-600 hover:text-purple-600 font-medium text-sm md:text-base whitespace-nowrap">Ä°letiÅŸim</button>
                <button onclick="switchTab('additional')" id="additionalTab" class="px-3 md:px-6 py-3 text-gray-600 hover:text-purple-600 font-medium text-sm md:text-base whitespace-nowrap">Ek Bilgi</button>
            </div>
            
            <form onsubmit="addPet(event)">
                <!-- Media Tab -->
                <div id="mediaContent" class="tab-content p-6">
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">Profil FotoÄŸrafÄ±</label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-purple-500 transition">
                                    <input type="file" id="profilePhoto" accept="image/*" class="hidden" onchange="handleFileUpload(this, 'profilePreview')">
                                    <div id="profilePreview" class="mb-4">
                                        <div class="text-4xl text-gray-400 mb-2">ğŸ“·</div>
                                        <p class="text-gray-600">Ana profil fotoÄŸrafÄ±nÄ± yÃ¼kleyin</p>
                                    </div>
                                    <button type="button" onclick="document.getElementById('profilePhoto').click()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition">FotoÄŸraf SeÃ§</button>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">Ek FotoÄŸraflar</label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-purple-500 transition">
                                    <input type="file" id="additionalPhotos" accept="image/*" multiple class="hidden" onchange="handleMultipleFiles(this, 'additionalPreview')">
                                    <div id="additionalPreview" class="mb-4">
                                        <div class="text-4xl text-gray-400 mb-2">ğŸ–¼ï¸</div>
                                        <p class="text-gray-600">Birden fazla fotoÄŸraf seÃ§in</p>
                                    </div>
                                    <button type="button" onclick="document.getElementById('additionalPhotos').click()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">FotoÄŸraflar SeÃ§</button>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Video</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-purple-500 transition">
                                <input type="file" id="petVideo" accept="video/*" class="hidden" onchange="handleFileUpload(this, 'videoPreview')">
                                <div id="videoPreview" class="mb-4">
                                    <div class="text-4xl text-gray-400 mb-2">ğŸ¥</div>
                                    <p class="text-gray-600">HayvanÄ±nÄ±zÄ±n videosunu yÃ¼kleyin</p>
                                </div>
                                <button type="button" onclick="document.getElementById('petVideo').click()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">Video SeÃ§</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Basic Info Tab -->
                <div id="basicContent" class="tab-content p-6 hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Hayvan AdÄ± *</label>
                            <input type="text" id="petName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" required>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">TÃ¼r *</label>
                            <select id="petType" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" required>
                                <option value="">SeÃ§iniz</option>
                                <option value="KÃ¶pek">KÃ¶pek</option>
                                <option value="Kedi">Kedi</option>
                                <option value="KuÅŸ">KuÅŸ</option>
                                <option value="BalÄ±k">BalÄ±k</option>
                                <option value="Hamster">Hamster</option>
                                <option value="TavÅŸan">TavÅŸan</option>
                                <option value="DiÄŸer">DiÄŸer</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Cinsi</label>
                            <input type="text" id="petBreed" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">YaÅŸ</label>
                            <input type="number" id="petAge" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Cinsiyet</label>
                            <select id="petGender" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                                <option value="">SeÃ§iniz</option>
                                <option value="Erkek">Erkek</option>
                                <option value="DiÅŸi">DiÅŸi</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Renk</label>
                            <input type="text" id="petColor" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">AÄŸÄ±rlÄ±k (kg)</label>
                            <input type="number" step="0.1" id="petWeight" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">DoÄŸum Tarihi</label>
                            <input type="date" id="birthDate" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Ã‡ip NumarasÄ±</label>
                            <input type="text" id="chipNumber" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Pasaport/Kimlik No</label>
                            <input type="text" id="passportNumber" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                        </div>
                    </div>
                </div>

                <!-- Health Info Tab -->
                <div id="healthContent" class="tab-content p-6 hidden">
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">Veteriner Hekim</label>
                                <input type="text" id="vetName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">Veteriner Telefon</label>
                                <input type="tel" id="vetPhone" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">AÅŸÄ± Durumu</label>
                            <textarea id="vaccinations" rows="3" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" placeholder="AÅŸÄ± bilgileri ve tarihleri"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">SaÄŸlÄ±k Durumu / HastalÄ±klar</label>
                            <textarea id="healthConditions" rows="3" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" placeholder="Kronik hastalÄ±klar, alerjiler vb."></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">KullandÄ±ÄŸÄ± Ä°laÃ§lar</label>
                            <textarea id="medications" rows="3" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" placeholder="DÃ¼zenli kullandÄ±ÄŸÄ± ilaÃ§lar"></textarea>
                        </div>
                        
                        <div class="flex flex-wrap gap-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="isNeutered" class="mr-2">
                                <span class="text-gray-700">KÄ±sÄ±rlaÅŸtÄ±rÄ±ldÄ±</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="isFriendly" class="mr-2">
                                <span class="text-gray-700">Ä°nsanlara DostÃ§a</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="isAggressive" class="mr-2">
                                <span class="text-gray-700">Dikkatli YaklaÅŸÄ±lmalÄ±</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Contact Tab -->
                <div id="contactContent" class="tab-content p-6 hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Sahip AdÄ± *</label>
                            <input type="text" id="ownerName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" required>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Telefon 1 *</label>
                            <input type="tel" id="ownerPhone1" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" required>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Telefon 2</label>
                            <input type="tel" id="ownerPhone2" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">E-posta</label>
                            <input type="email" id="ownerEmail" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Adres</label>
                            <textarea id="ownerAddress" rows="3" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Facebook Profili</label>
                            <input type="url" id="facebookUrl" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" placeholder="https://facebook.com/...">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Instagram Profili</label>
                            <input type="url" id="instagramUrl" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" placeholder="https://instagram.com/...">
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2">WhatsApp NumarasÄ±</label>
                            <input type="tel" id="whatsappNumber" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" placeholder="90XXXXXXXXXX">
                        </div>
                    </div>
                </div>

                <!-- Additional Info Tab -->
                <div id="additionalContent" class="tab-content p-6 hidden">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Hayvan HakkÄ±nda Genel Bilgiler</label>
                            <textarea id="aboutPet" rows="4" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" placeholder="HayvanÄ±nÄ±zÄ±n karakteri, sevdiÄŸi aktiviteler, beslenme alÄ±ÅŸkanlÄ±klarÄ± vb. hakkÄ±nda bilgiler yazÄ±n..."></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">DavranÄ±ÅŸ Ã–zellikleri</label>
                            <textarea id="behaviorNotes" rows="3" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" placeholder="DiÄŸer hayvanlarla iliÅŸkisi, Ã§ocuklarla etkileÅŸimi, Ã¶zel davranÄ±ÅŸlarÄ± vb."></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Beslenme Bilgileri</label>
                            <textarea id="feedingInfo" rows="3" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" placeholder="Mama markasÄ±, beslenme saatleri, Ã¶zel diyet gereksinimleri vb."></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Ã–zel Notlar ve Dikkat Edilmesi Gerekenler</label>
                            <textarea id="specialNotes" rows="4" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" placeholder="Acil durumlarda bilinmesi gereken Ã¶zel durumlar, alerjiler, korkularÄ± vb."></textarea>
                        </div>
                        
                        <!-- Custom Information Boxes -->
                        <div>
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="text-lg font-semibold text-purple-600">Ã–zel Bilgi KutularÄ±</h4>
                                <button type="button" onclick="addCustomInfoBox()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition text-sm">+ Bilgi Kutusu Ekle</button>
                            </div>
                            <div id="customInfoBoxes" class="space-y-4">
                                <!-- Custom info boxes will be added here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="p-4 md:p-6 border-t bg-gray-50">
                    <div class="flex flex-col sm:flex-row justify-between space-y-3 sm:space-y-0">
                        <button type="button" onclick="hideForms()" class="px-4 md:px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition text-sm md:text-base">Ä°ptal</button>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                            <button type="button" onclick="prevTab()" id="prevBtn" class="px-4 md:px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition hidden text-sm md:text-base">â† Ã–nceki</button>
                            <button type="button" onclick="nextTab()" id="nextBtn" class="px-4 md:px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition text-sm md:text-base">Sonraki â†’</button>
                            <button type="submit" id="submitBtn" class="px-4 md:px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition hidden text-sm md:text-base">Profili OluÅŸtur</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Pet Profile View -->
        <div id="petProfile" class="hidden max-w-4xl mx-auto">
            <!-- Pet profile content will be inserted here -->
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let pets = [];
        let users = [];
        let analytics = {};
        let uploadedFiles = {};
        let currentTab = 'media';
        let customInfoBoxCount = 0;

        // GLOBAL CLOUD DATABASE - TÃ¼m cihazlarda eriÅŸilebilir
        const GLOBAL_CLOUD_DB_KEY = 'PETID_GLOBAL_DATABASE_V2';
        
        // Bulut veritabanÄ±nÄ± simÃ¼le eden global sistem
        function getGlobalDatabase() {
            // GerÃ§ek uygulamada bu bir API Ã§aÄŸrÄ±sÄ± olurdu
            // Åimdilik tarayÄ±cÄ±nÄ±n global storage'Ä±nÄ± kullanÄ±yoruz
            try {
                const stored = localStorage.getItem(GLOBAL_CLOUD_DB_KEY);
                if (stored) {
                    return JSON.parse(stored);
                }
            } catch (e) {
                console.log('VeritabanÄ± okuma hatasÄ±:', e);
            }
            
            return {
                users: [],
                pets: [],
                analytics: {},
                lastSync: new Date().toISOString()
            };
        }
        
        function saveToGlobalDatabase(data) {
            try {
                data.lastSync = new Date().toISOString();
                localStorage.setItem(GLOBAL_CLOUD_DB_KEY, JSON.stringify(data));
                return true;
            } catch (e) {
                console.log('VeritabanÄ± kaydetme hatasÄ±:', e);
                return false;
            }
        }

        // Load data from cloud database
        function loadCloudData() {
            const globalDB = getGlobalDatabase();
            users = [...globalDB.users];
            pets = [...globalDB.pets];
            analytics = {...globalDB.analytics};
            
            console.log(`Bulut veritabanÄ±ndan yÃ¼klendi: ${pets.length} hayvan, ${users.length} kullanÄ±cÄ±`);
        }
        
        function saveCloudData() {
            const globalDB = {
                users: users,
                pets: pets,
                analytics: analytics
            };
            
            const success = saveToGlobalDatabase(globalDB);
            if (success) {
                console.log('Veriler bulut veritabanÄ±na kaydedildi');
            } else {
                console.log('Bulut veritabanÄ±na kaydetme baÅŸarÄ±sÄ±z');
            }
            return success;
        }

        // Demo veri oluÅŸturma fonksiyonu
        function createDemoData() {
            const globalDB = getGlobalDatabase();
            
            // EÄŸer zaten veri varsa demo oluÅŸturma
            if (globalDB.pets.length > 0) {
                return;
            }
            
            console.log('Demo veriler oluÅŸturuluyor...');
            
            // Demo kullanÄ±cÄ±
            const demoUser = {
                id: 1001,
                name: 'Ahmet YÄ±lmaz',
                email: 'demo@petid.com',
                phone: '0532 123 45 67',
                password: 'demo123',
                createdAt: new Date().toISOString()
            };
            
            // Demo hayvan
            const demoPet = {
                id: 2001,
                userId: 1001,
                name: 'KarabaÅŸ',
                type: 'KÃ¶pek',
                breed: 'Golden Retriever',
                age: '3',
                gender: 'Erkek',
                color: 'AltÄ±n SarÄ±sÄ±',
                weight: '28',
                birthDate: '2021-05-15',
                ownerName: 'Ahmet YÄ±lmaz',
                ownerPhone1: '0532 123 45 67',
                ownerPhone2: '0216 456 78 90',
                ownerEmail: 'ahmet@example.com',
                ownerAddress: 'KadÄ±kÃ¶y, Ä°stanbul',
                vetName: 'Dr. Mehmet Veteriner',
                vetPhone: '0212 987 65 43',
                facebookUrl: 'https://facebook.com/ahmetyilmaz',
                instagramUrl: 'https://instagram.com/ahmetyilmaz',
                whatsappNumber: '905321234567',
                chipNumber: 'TR123456789',
                passportNumber: 'PET001234',
                vaccinations: 'Kuduz, Karma aÅŸÄ±larÄ± gÃ¼ncel (Son: 15.03.2024)',
                healthConditions: 'SaÄŸlÄ±klÄ±, herhangi bir kronik hastalÄ±ÄŸÄ± yok',
                medications: 'DÃ¼zenli ilaÃ§ kullanÄ±mÄ± yok',
                aboutPet: 'Ã‡ok sevecen ve oyuncu bir kÃ¶pek. Ã‡ocuklarla Ã§ok iyi anlaÅŸÄ±r. Top oynamayÄ± ve yÃ¼zmeyi Ã§ok sever.',
                behaviorNotes: 'DiÄŸer kÃ¶peklerle iyi geÃ§inir. Ã‡ok sosyal ve eÄŸitimli. KomutlarÄ± iyi bilir.',
                feedingInfo: 'GÃ¼nde 2 Ã¶ÄŸÃ¼n yetiÅŸkin kÃ¶pek mamasÄ±. Royal Canin Golden Retriever kullanÄ±yor.',
                specialNotes: 'Su korkusu yok, Ã§ok iyi yÃ¼zer. GÃ¼rÃ¼ltÃ¼den korkmaz. Ã‡ok enerjik, gÃ¼nlÃ¼k egzersiz gerekir.',
                customInfoBoxes: [
                    {
                        title: 'SevdiÄŸi Oyuncaklar',
                        content: 'Tenis topu, ip oyuncaÄŸÄ± ve squeaky oyuncaklarÄ± Ã§ok sever'
                    },
                    {
                        title: 'Favori Yerleri',
                        content: 'Caddebostan sahili, FenerbahÃ§e parkÄ±, evdeki bahÃ§e'
                    }
                ],
                isNeutered: true,
                isFriendly: true,
                isAggressive: false,
                profilePhoto: null,
                additionalPhotos: [],
                video: null,
                createdAt: new Date().toISOString(),
                link: `${window.location.origin}${window.location.pathname}#pet=2001`
            };
            
            // Demo analitik
            const demoAnalytics = {
                2001: {
                    views: 15,
                    calls: 3,
                    locations: 2,
                    viewHistory: [
                        {
                            timestamp: new Date(Date.now() - 86400000).toISOString(),
                            userAgent: 'Demo Browser',
                            referrer: 'Direkt EriÅŸim',
                            screenSize: '1920x1080',
                            language: 'tr-TR',
                            latitude: 40.9887,
                            longitude: 29.0269,
                            locationAccuracy: 50
                        }
                    ],
                    locationHistory: [
                        {
                            timestamp: new Date(Date.now() - 43200000).toISOString(),
                            latitude: 40.9887,
                            longitude: 29.0269,
                            accuracy: 50
                        }
                    ]
                }
            };
            
            // Demo verileri kaydet
            const newGlobalDB = {
                users: [demoUser],
                pets: [demoPet],
                analytics: demoAnalytics
            };
            
            saveToGlobalDatabase(newGlobalDB);
            console.log('Demo veriler oluÅŸturuldu ve kaydedildi!');
        }

        // Initialize app - Check for pet link FIRST
        function init() {
            // CRITICAL: Load cloud data first so pet links work everywhere
            loadCloudData();
            
            // Demo veri oluÅŸtur (sadece ilk Ã§alÄ±ÅŸtÄ±rmada)
            createDemoData();
            
            // Verileri tekrar yÃ¼kle (demo veriler dahil)
            loadCloudData();
            
            // PRIORITY: Check for pet link on page load
            const hash = window.location.hash;
            if (hash.startsWith('#pet=')) {
                const petId = parseInt(hash.replace('#pet=', ''));
                const pet = pets.find(p => p.id === petId);
                if (pet) {
                    viewPetProfilePublic(petId);
                    return; // Stop here, don't load user dashboard
                } else {
                    showPetNotFoundMessage();
                    return;
                }
            }
            
            // Only check user login if no pet link - but don't show all pets to everyone
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
            } else {
                // Show welcome page - no access to any pet data without login
                hideAll();
                document.getElementById('welcomeSection').classList.remove('hidden');
            }
            
            // Handle hash changes for navigation
            window.addEventListener('hashchange', handleHashChange);
        }

        // Hash-based routing
        function handleHashChange() {
            // Reload cloud data on hash change to ensure fresh data
            loadCloudData();
            
            const hash = window.location.hash;
            if (hash.startsWith('#pet=')) {
                const petId = parseInt(hash.replace('#pet=', ''));
                const pet = pets.find(p => p.id === petId);
                if (pet) {
                    viewPetProfilePublic(petId);
                    return;
                } else {
                    showPetNotFoundMessage();
                    return;
                }
            }
            
            // Handle other navigation
            if (currentUser && !hash) {
                showDashboard();
            } else if (!hash) {
                hideAll();
                document.getElementById('welcomeSection').classList.remove('hidden');
            }
        }

        // Public pet profile view (for shared links)
        function viewPetProfilePublic(petId) {
            const pet = pets.find(p => p.id === petId);
            if (!pet) {
                showPetNotFoundMessage();
                return;
            }
            
            // Track view with detailed information
            if (!analytics[petId]) {
                analytics[petId] = { views: 0, calls: 0, locations: 0, viewHistory: [], locationHistory: [] };
            }
            analytics[petId].views++;
            
            const viewData = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                referrer: document.referrer || 'Direkt EriÅŸim',
                screenSize: `${screen.width}x${screen.height}`,
                language: navigator.language
            };
            
            // Try to get location for view tracking
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        viewData.latitude = position.coords.latitude;
                        viewData.longitude = position.coords.longitude;
                        viewData.locationAccuracy = position.coords.accuracy;
                        analytics[petId].viewHistory.push(viewData);
                        saveCloudData();
                    },
                    function(error) {
                        viewData.locationError = 'Konum eriÅŸimi reddedildi';
                        analytics[petId].viewHistory.push(viewData);
                        saveCloudData();
                    }
                );
            } else {
                viewData.locationError = 'Konum desteklenmiyor';
                analytics[petId].viewHistory.push(viewData);
                saveCloudData();
            }
            
            hideAll();
            const profileDiv = document.getElementById('petProfile');
            profileDiv.innerHTML = generatePetProfileHTML(pet, true); // true for public view
            profileDiv.classList.remove('hidden');
        }

        function showPetNotFoundMessage() {
            hideAll();
            const container = document.querySelector('.container');
            container.innerHTML = `
                <div class="text-center py-12 px-4">
                    <div class="text-6xl mb-4">ğŸ¾</div>
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4">Hayvan Profili BulunamadÄ±</h2>
                    <p class="text-lg text-gray-600 mb-8">Bu link geÃ§ersiz veya hayvan profili silinmiÅŸ olabilir.</p>
                    <button onclick="window.location.href = window.location.origin + window.location.pathname" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition">Ana Sayfaya DÃ¶n</button>
                </div>
            `;
        }

        // File upload functions
        function handleFileUpload(input, previewId) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById(previewId);
                uploadedFiles[input.id] = e.target.result;
                
                if (file.type.startsWith('image/')) {
                    preview.innerHTML = `
                        <img src="${e.target.result}" class="max-w-full h-32 object-cover rounded-lg mx-auto mb-2">
                        <p class="text-sm text-gray-600">${file.name}</p>
                        <button type="button" onclick="removeFile('${input.id}', '${previewId}')" class="text-red-500 text-sm hover:underline">KaldÄ±r</button>
                    `;
                } else if (file.type.startsWith('video/')) {
                    preview.innerHTML = `
                        <video controls class="max-w-full h-32 rounded-lg mx-auto mb-2">
                            <source src="${e.target.result}" type="${file.type}">
                        </video>
                        <p class="text-sm text-gray-600">${file.name}</p>
                        <button type="button" onclick="removeFile('${input.id}', '${previewId}')" class="text-red-500 text-sm hover:underline">KaldÄ±r</button>
                    `;
                }
            };
            reader.readAsDataURL(file);
        }
        
        function handleMultipleFiles(input, previewId) {
            const files = Array.from(input.files);
            if (files.length === 0) return;
            
            const preview = document.getElementById(previewId);
            uploadedFiles[input.id] = [];
            
            let previewHTML = '<div class="grid grid-cols-2 gap-2 mb-2">';
            
            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedFiles[input.id].push(e.target.result);
                    
                    if (file.type.startsWith('image/')) {
                        previewHTML += `<img src="${e.target.result}" class="w-full h-20 object-cover rounded">`;
                    }
                    
                    if (index === files.length - 1) {
                        previewHTML += '</div>';
                        previewHTML += `<p class="text-sm text-gray-600">${files.length} fotoÄŸraf seÃ§ildi</p>`;
                        previewHTML += `<button type="button" onclick="removeFile('${input.id}', '${previewId}')" class="text-red-500 text-sm hover:underline">TÃ¼mÃ¼nÃ¼ KaldÄ±r</button>`;
                        preview.innerHTML = previewHTML;
                    }
                };
                reader.readAsDataURL(file);
            });
        }
        
        function removeFile(inputId, previewId) {
            delete uploadedFiles[inputId];
            document.getElementById(inputId).value = '';
            
            const preview = document.getElementById(previewId);
            if (inputId === 'profilePhoto') {
                preview.innerHTML = `
                    <div class="text-4xl text-gray-400 mb-2">ğŸ“·</div>
                    <p class="text-gray-600">Profil fotoÄŸrafÄ± yÃ¼kleyin</p>
                `;
            } else if (inputId === 'additionalPhotos') {
                preview.innerHTML = `
                    <div class="text-4xl text-gray-400 mb-2">ğŸ–¼ï¸</div>
                    <p class="text-gray-600">Birden fazla fotoÄŸraf seÃ§in</p>
                `;
            } else if (inputId === 'petVideo') {
                preview.innerHTML = `
                    <div class="text-4xl text-gray-400 mb-2">ğŸ¥</div>
                    <p class="text-gray-600">HayvanÄ±nÄ±zÄ±n videosunu yÃ¼kleyin</p>
                `;
            }
        }

        // Tab navigation functions
        function switchTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.add('hidden'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('[id$="Tab"]');
            tabs.forEach(tab => {
                tab.classList.remove('border-b-2', 'border-purple-600', 'text-purple-600');
                tab.classList.add('text-gray-600');
            });
            
            // Show selected tab content
            document.getElementById(tabName + 'Content').classList.remove('hidden');
            
            // Add active class to selected tab
            const activeTab = document.getElementById(tabName + 'Tab');
            activeTab.classList.add('border-b-2', 'border-purple-600', 'text-purple-600');
            activeTab.classList.remove('text-gray-600');
            
            currentTab = tabName;
            updateNavigationButtons();
        }
        
        function nextTab() {
            const tabs = ['media', 'basic', 'health', 'contact', 'additional'];
            const currentIndex = tabs.indexOf(currentTab);
            if (currentIndex < tabs.length - 1) {
                switchTab(tabs[currentIndex + 1]);
            }
        }
        
        function prevTab() {
            const tabs = ['media', 'basic', 'health', 'contact', 'additional'];
            const currentIndex = tabs.indexOf(currentTab);
            if (currentIndex > 0) {
                switchTab(tabs[currentIndex - 1]);
            }
        }
        
        function updateNavigationButtons() {
            const tabs = ['media', 'basic', 'health', 'contact', 'additional'];
            const currentIndex = tabs.indexOf(currentTab);
            
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            // Show/hide previous button
            if (currentIndex === 0) {
                prevBtn.classList.add('hidden');
            } else {
                prevBtn.classList.remove('hidden');
            }
            
            // Show/hide next and submit buttons
            if (currentIndex === tabs.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
        }
        
        function addCustomInfoBox() {
            customInfoBoxCount++;
            const container = document.getElementById('customInfoBoxes');
            const boxId = 'customBox' + customInfoBoxCount;
            
            const boxHTML = `
                <div id="${boxId}" class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                    <div class="flex justify-between items-center mb-3">
                        <input type="text" placeholder="BaÅŸlÄ±k (Ã¶rn: SevdiÄŸi Oyuncaklar)" class="font-medium text-gray-700 bg-transparent border-b border-gray-300 focus:border-purple-500 focus:outline-none flex-1 mr-4" name="customTitle${customInfoBoxCount}">
                        <button type="button" onclick="removeCustomInfoBox('${boxId}')" class="text-red-500 hover:text-red-700 text-sm">KaldÄ±r</button>
                    </div>
                    <textarea placeholder="Bu konuda detaylÄ± bilgi yazÄ±n..." rows="3" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500 resize-none" name="customContent${customInfoBoxCount}"></textarea>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', boxHTML);
        }
        
        function removeCustomInfoBox(boxId) {
            document.getElementById(boxId).remove();
        }

        // Navigation functions
        function showLogin() {
            hideAll();
            document.getElementById('loginForm').classList.remove('hidden');
            window.location.hash = '';
        }

        function showRegister() {
            hideAll();
            document.getElementById('registerForm').classList.remove('hidden');
            window.location.hash = '';
        }

        function showDashboard() {
            hideAll();
            document.getElementById('dashboard').classList.remove('hidden');
            updateStats();
            displayPets();
            window.location.hash = '';
        }

        function showAddPet() {
            hideAll();
            document.getElementById('addPetForm').classList.remove('hidden');
            // Pre-fill owner info
            if (currentUser) {
                document.getElementById('ownerName').value = currentUser.name;
                document.getElementById('ownerEmail').value = currentUser.email;
                document.getElementById('ownerPhone1').value = currentUser.phone;
            }
            window.location.hash = '';
        }

        function hideForms() {
            showDashboard();
        }

        function hideAll() {
            const sections = ['welcomeSection', 'loginForm', 'registerForm', 'dashboard', 'addPetForm', 'petProfile'];
            sections.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
        }

        // Authentication
        function register(event) {
            event.preventDefault();
            
            // Ensure we have latest data
            loadCloudData();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const phone = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;

            // Check if user exists
            if (users.find(u => u.email === email)) {
                showMessage('Bu e-posta adresi zaten kayÄ±tlÄ±!', 'error');
                return;
            }

            const user = {
                id: Date.now(),
                name,
                email,
                phone,
                password,
                createdAt: new Date().toISOString()
            };

            users.push(user);
            
            // BULUT VERÄ°TABANINA KAYDET
            const success = saveCloudData();
            if (!success) {
                showMessage('KayÄ±t sÄ±rasÄ±nda hata oluÅŸtu, tekrar deneyin!', 'error');
                return;
            }
            
            currentUser = user;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            showMessage('KayÄ±t baÅŸarÄ±lÄ±! HoÅŸ geldiniz!', 'success');
            showDashboard();
        }

        function login(event) {
            event.preventDefault();
            
            // Ensure we have latest data
            loadCloudData();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showMessage('GiriÅŸ baÅŸarÄ±lÄ±!', 'success');
                showDashboard();
            } else {
                showMessage('E-posta veya ÅŸifre hatalÄ±! LÃ¼tfen bilgilerinizi kontrol edin.', 'error');
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            hideAll();
            document.getElementById('welcomeSection').classList.remove('hidden');
            window.location.hash = '';
        }

        // Pet management
        function addPet(event) {
            event.preventDefault();
            
            // Collect custom info boxes
            const customInfoBoxes = [];
            const customTitles = document.querySelectorAll('[name^="customTitle"]');
            const customContents = document.querySelectorAll('[name^="customContent"]');
            
            for (let i = 0; i < customTitles.length; i++) {
                if (customTitles[i].value.trim() || customContents[i].value.trim()) {
                    customInfoBoxes.push({
                        title: customTitles[i].value.trim(),
                        content: customContents[i].value.trim()
                    });
                }
            }
            
            const petId = Date.now();
            const petData = {
                id: petId,
                userId: currentUser.id,
                name: document.getElementById('petName').value,
                type: document.getElementById('petType').value,
                breed: document.getElementById('petBreed').value,
                age: document.getElementById('petAge').value,
                gender: document.getElementById('petGender').value,
                color: document.getElementById('petColor').value,
                weight: document.getElementById('petWeight').value,
                birthDate: document.getElementById('birthDate').value,
                ownerName: document.getElementById('ownerName').value,
                ownerPhone1: document.getElementById('ownerPhone1').value,
                ownerPhone2: document.getElementById('ownerPhone2').value,
                ownerEmail: document.getElementById('ownerEmail').value,
                ownerAddress: document.getElementById('ownerAddress').value,
                vetName: document.getElementById('vetName').value,
                vetPhone: document.getElementById('vetPhone').value,
                facebookUrl: document.getElementById('facebookUrl').value,
                instagramUrl: document.getElementById('instagramUrl').value,
                whatsappNumber: document.getElementById('whatsappNumber').value,
                chipNumber: document.getElementById('chipNumber').value,
                passportNumber: document.getElementById('passportNumber').value,
                vaccinations: document.getElementById('vaccinations').value,
                healthConditions: document.getElementById('healthConditions').value,
                medications: document.getElementById('medications').value,
                aboutPet: document.getElementById('aboutPet').value,
                behaviorNotes: document.getElementById('behaviorNotes').value,
                feedingInfo: document.getElementById('feedingInfo').value,
                specialNotes: document.getElementById('specialNotes').value,
                customInfoBoxes: customInfoBoxes,
                isNeutered: document.getElementById('isNeutered').checked,
                isFriendly: document.getElementById('isFriendly').checked,
                isAggressive: document.getElementById('isAggressive').checked,
                profilePhoto: uploadedFiles.profilePhoto || null,
                additionalPhotos: uploadedFiles.additionalPhotos || [],
                video: uploadedFiles.petVideo || null,
                createdAt: new Date().toISOString(),
                link: `${window.location.origin}${window.location.pathname}#pet=${petId}`
            };

            pets.push(petData);
            
            // Initialize analytics for this pet
            analytics[petData.id] = {
                views: 0,
                calls: 0,
                locations: 0,
                viewHistory: [],
                locationHistory: []
            };
            
            // BULUT VERÄ°TABANINA KAYDET
            const success = saveCloudData();
            if (!success) {
                showMessage('Hayvan profili kaydedilirken hata oluÅŸtu!', 'error');
                return;
            }
            
            // Reset form and uploaded files
            document.getElementById('addPetForm').querySelector('form').reset();
            uploadedFiles = {};
            customInfoBoxCount = 0;
            currentTab = 'media';
            
            // Clear custom info boxes
            document.getElementById('customInfoBoxes').innerHTML = '';
            
            // Reset file previews
            document.getElementById('profilePreview').innerHTML = `
                <div class="text-4xl text-gray-400 mb-2">ğŸ“·</div>
                <p class="text-gray-600">Ana profil fotoÄŸrafÄ±nÄ± yÃ¼kleyin</p>
            `;
            document.getElementById('additionalPreview').innerHTML = `
                <div class="text-4xl text-gray-400 mb-2">ğŸ–¼ï¸</div>
                <p class="text-gray-600">Birden fazla fotoÄŸraf seÃ§in</p>
            `;
            document.getElementById('videoPreview').innerHTML = `
                <div class="text-4xl text-gray-400 mb-2">ğŸ¥</div>
                <p class="text-gray-600">HayvanÄ±nÄ±zÄ±n videosunu yÃ¼kleyin</p>
            `;
            
            // Reset to first tab
            switchTab('media');
            
            showDashboard();
            
            // Show success message with link
            setTimeout(() => {
                showSuccessModal(petData.link);
            }, 100);
        }

        function displayPets() {
            const petList = document.getElementById('petList');
            
            // SECURITY: Only show pets belonging to the current logged-in user
            if (!currentUser) {
                petList.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">GiriÅŸ yapmanÄ±z gerekiyor.</div>';
                return;
            }
            
            const userPets = pets.filter(pet => pet.userId === currentUser.id);
            
            if (userPets.length === 0) {
                petList.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">HenÃ¼z hayvan eklenmemiÅŸ. Ä°lk hayvanÄ±nÄ±zÄ± ekleyin!</div>';
                return;
            }
            
            petList.innerHTML = userPets.map(pet => {
                const petAnalytics = analytics[pet.id] || { views: 0, calls: 0, locations: 0 };
                return `
                    <div class="pet-card p-6">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h4 class="text-xl font-bold text-gray-800">${pet.name}</h4>
                                <p class="text-gray-600">${pet.type} â€¢ ${pet.breed || 'Melez'}</p>
                            </div>
                            <div class="text-2xl">${pet.type === 'KÃ¶pek' ? 'ğŸ•' : pet.type === 'Kedi' ? 'ğŸ±' : 'ğŸ¾'}</div>
                        </div>
                        
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">GÃ¶rÃ¼ntÃ¼lenme:</span>
                                <span class="font-medium">${petAnalytics.views}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Arama:</span>
                                <span class="font-medium">${petAnalytics.calls}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Konum:</span>
                                <span class="font-medium">${petAnalytics.locations}</span>
                            </div>
                        </div>
                        
                        <div class="space-y-2">
                            <button onclick="viewPetProfile(${pet.id})" class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition text-sm">Profili GÃ¶rÃ¼ntÃ¼le</button>
                            <button onclick="copyLink('${pet.link}')" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition text-sm">Linki Kopyala</button>
                            <button onclick="viewAnalytics(${pet.id})" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition text-sm">Analitik</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function viewPetProfile(petId) {
            const pet = pets.find(p => p.id === petId);
            if (!pet) return;
            
            // SECURITY: Only pet owner can view from dashboard
            if (!currentUser || pet.userId !== currentUser.id) {
                showMessage('Bu hayvana eriÅŸim yetkiniz yok!', 'error');
                return;
            }
            
            // Simulate view tracking
            if (!analytics[petId]) {
                analytics[petId] = { views: 0, calls: 0, locations: 0, viewHistory: [] };
            }
            analytics[petId].views++;
            analytics[petId].viewHistory.push({
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                location: 'Sahip GÃ¶rÃ¼ntÃ¼leme'
            });
            saveCloudData();
            
            hideAll();
            const profileDiv = document.getElementById('petProfile');
            profileDiv.innerHTML = generatePetProfileHTML(pet, false); // false for owner view
            profileDiv.classList.remove('hidden');
        }

        function generatePetProfileHTML(pet, isPublicView = false) {
            return `
                <div class="bg-white rounded-xl card-shadow overflow-hidden">
                    <!-- Header -->
                    <div class="gradient-bg text-white p-8 text-center">
                        ${pet.profilePhoto ? 
                            `<img src="${pet.profilePhoto}" class="w-32 h-32 rounded-full mx-auto mb-4 object-cover border-4 border-white shadow-lg">` : 
                            `<div class="text-6xl mb-4">${pet.type === 'KÃ¶pek' ? 'ğŸ•' : pet.type === 'Kedi' ? 'ğŸ±' : 'ğŸ¾'}</div>`
                        }
                        <h1 class="text-4xl font-bold mb-2">${pet.name}</h1>
                        <p class="text-xl opacity-90">${pet.type} â€¢ ${pet.breed || 'Melez'}</p>
                        ${isPublicView ? 
                            `<div class="mt-4 p-4 bg-red-100 border border-red-300 rounded-lg">
                                <div class="text-red-800 font-bold text-lg mb-2">ğŸš¨ KAYIP HAYVAN BULUNDU!</div>
                                <div class="text-red-700 text-sm">Bu hayvanÄ± bulduysanÄ±z lÃ¼tfen aÅŸaÄŸÄ±daki iletiÅŸim bilgilerini kullanarak sahibiyle iletiÅŸime geÃ§in. Konum bilginiz otomatik olarak sahibine iletilecektir.</div>
                            </div>` :
                            `<button onclick="showDashboard()" class="mt-4 bg-white text-purple-600 px-4 py-2 rounded-lg hover:bg-gray-100 transition">â† Geri DÃ¶n</button>`
                        }
                    </div>
                    
                    <!-- Content -->
                    <div class="p-8">
                        <!-- Photo Gallery -->
                        ${pet.additionalPhotos && pet.additionalPhotos.length > 0 ? `
                        <div class="mb-8">
                            <h3 class="text-xl font-bold text-purple-600 mb-4">FotoÄŸraf Galerisi</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                ${pet.additionalPhotos.map(photo => `
                                    <img src="${photo}" class="w-full h-24 object-cover rounded-lg cursor-pointer hover:opacity-80 transition" onclick="showImageModal('${photo}')">
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- Video -->
                        ${pet.video ? `
                        <div class="mb-8">
                            <h3 class="text-xl font-bold text-purple-600 mb-4">Video</h3>
                            <video controls class="w-full max-w-md mx-auto rounded-lg">
                                <source src="${pet.video}" type="video/mp4">
                            </video>
                        </div>
                        ` : ''}
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Basic Info -->
                            <div class="space-y-6">
                                <div>
                                    <h3 class="text-xl font-bold text-purple-600 mb-4">Temel Bilgiler</h3>
                                    <div class="space-y-3">
                                        ${pet.age ? `<div class="flex justify-between"><span class="text-gray-600">YaÅŸ:</span><span class="font-medium">${pet.age} yaÅŸÄ±nda</span></div>` : ''}
                                        ${pet.birthDate ? `<div class="flex justify-between"><span class="text-gray-600">DoÄŸum Tarihi:</span><span class="font-medium">${new Date(pet.birthDate).toLocaleDateString('tr-TR')}</span></div>` : ''}
                                        ${pet.gender ? `<div class="flex justify-between"><span class="text-gray-600">Cinsiyet:</span><span class="font-medium">${pet.gender}</span></div>` : ''}
                                        ${pet.color ? `<div class="flex justify-between"><span class="text-gray-600">Renk:</span><span class="font-medium">${pet.color}</span></div>` : ''}
                                        ${pet.weight ? `<div class="flex justify-between"><span class="text-gray-600">AÄŸÄ±rlÄ±k:</span><span class="font-medium">${pet.weight} kg</span></div>` : ''}
                                        ${pet.chipNumber ? `<div class="flex justify-between"><span class="text-gray-600">Ã‡ip No:</span><span class="font-medium">${pet.chipNumber}</span></div>` : ''}
                                        ${pet.passportNumber ? `<div class="flex justify-between"><span class="text-gray-600">Pasaport No:</span><span class="font-medium">${pet.passportNumber}</span></div>` : ''}
                                    </div>
                                </div>
                                
                                ${pet.aboutPet ? `
                                <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg">
                                    <h4 class="font-bold text-blue-800 mb-2">HakkÄ±nda:</h4>
                                    <p class="text-blue-700">${pet.aboutPet}</p>
                                </div>
                                ` : ''}
                                </div>
                                
                                <!-- Health Status -->
                                <div>
                                    <h3 class="text-xl font-bold text-purple-600 mb-4">SaÄŸlÄ±k Durumu</h3>
                                    <div class="space-y-3">
                                        <div class="flex flex-wrap gap-2">
                                            ${pet.isNeutered ? '<span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">KÄ±sÄ±rlaÅŸtÄ±rÄ±ldÄ±</span>' : ''}
                                            ${pet.isFriendly ? '<span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">DostÃ§a</span>' : ''}
                                            ${pet.isAggressive ? '<span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm">Dikkatli YaklaÅŸÄ±n</span>' : ''}
                                        </div>
                                        ${pet.vaccinations ? `<div><span class="text-gray-600 font-medium">AÅŸÄ±lar:</span><p class="text-gray-800 mt-1">${pet.vaccinations}</p></div>` : ''}
                                        ${pet.healthConditions ? `<div><span class="text-gray-600 font-medium">SaÄŸlÄ±k Durumu:</span><p class="text-gray-800 mt-1">${pet.healthConditions}</p></div>` : ''}
                                        ${pet.medications ? `<div><span class="text-gray-600 font-medium">Ä°laÃ§lar:</span><p class="text-gray-800 mt-1">${pet.medications}</p></div>` : ''}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Contact Info -->
                            <div class="space-y-6">
                                <div>
                                    <h3 class="text-xl font-bold text-purple-600 mb-4">Ä°letiÅŸim Bilgileri</h3>
                                    <div class="space-y-4">
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <p class="font-medium text-gray-800 mb-2">${pet.ownerName}</p>
                                            <div class="space-y-2">
                                                <button onclick="trackCall('${pet.ownerPhone1}', ${pet.id})" class="flex items-center w-full bg-red-600 text-white px-4 py-3 rounded-lg hover:bg-red-700 transition text-lg font-bold animate-pulse">
                                                    <span class="mr-2">ğŸš¨</span> ACÄ°L ARAMA: ${pet.ownerPhone1}
                                                </button>
                                                ${pet.ownerPhone2 ? `<button onclick="trackCall('${pet.ownerPhone2}', ${pet.id})" class="flex items-center w-full bg-red-600 text-white px-4 py-3 rounded-lg hover:bg-red-700 transition text-lg font-bold"><span class="mr-2">ğŸ“</span> YEDEK: ${pet.ownerPhone2}</button>` : ''}
                                                ${pet.ownerEmail ? `<a href="mailto:${pet.ownerEmail}" class="flex items-center w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"><span class="mr-2">âœ‰ï¸</span> E-posta GÃ¶nder</a>` : ''}
                                                ${pet.whatsappNumber ? `<a href="https://wa.me/${pet.whatsappNumber}" target="_blank" rel="noopener noreferrer" class="flex items-center w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition"><span class="mr-2">ğŸ’¬</span> WhatsApp</a>` : ''}
                                            </div>
                                        </div>
                                        
                                        ${pet.facebookUrl || pet.instagramUrl ? `
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <p class="font-medium text-gray-700 mb-2">Sosyal Medya:</p>
                                            <div class="space-y-2">
                                                ${pet.facebookUrl ? `<a href="${pet.facebookUrl}" target="_blank" rel="noopener noreferrer" class="flex items-center w-full bg-blue-800 text-white px-4 py-2 rounded-lg hover:bg-blue-900 transition"><span class="mr-2">ğŸ“˜</span> Facebook</a>` : ''}
                                                ${pet.instagramUrl ? `<a href="${pet.instagramUrl}" target="_blank" rel="noopener noreferrer" class="flex items-center w-full bg-pink-600 text-white px-4 py-2 rounded-lg hover:bg-pink-700 transition"><span class="mr-2">ğŸ“·</span> Instagram</a>` : ''}
                                            </div>
                                        </div>
                                        ` : ''}
                                        
                                        ${pet.ownerAddress ? `
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <p class="font-medium text-gray-700 mb-2">Adres:</p>
                                            <p class="text-gray-800">${pet.ownerAddress}</p>
                                            <button onclick="trackLocation(${pet.id})" class="mt-2 bg-orange-600 text-white px-4 py-3 rounded-lg hover:bg-orange-700 transition w-full font-bold">
                                                ğŸ“ BULDUÄUM YER - Sahibine Konum GÃ¶nder
                                            </button>
                                        </div>
                                        ` : ''}
                                        
                                        ${pet.vetName ? `
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <p class="font-medium text-gray-700 mb-2">Veteriner Hekim:</p>
                                            <p class="text-gray-800">${pet.vetName}</p>
                                            ${pet.vetPhone ? `<button onclick="trackCall('${pet.vetPhone}', ${pet.id})" class="mt-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition w-full"><span class="mr-2">ğŸ¥</span> ${pet.vetPhone}</button>` : ''}
                                        </div>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Additional Information Sections -->
                        <div class="mt-8 space-y-6">
                            ${pet.behaviorNotes ? `
                            <div class="bg-green-50 border-l-4 border-green-400 p-4 rounded-r-lg">
                                <h4 class="font-bold text-green-800 mb-2">DavranÄ±ÅŸ Ã–zellikleri:</h4>
                                <p class="text-green-700">${pet.behaviorNotes}</p>
                            </div>
                            ` : ''}
                            
                            ${pet.feedingInfo ? `
                            <div class="bg-orange-50 border-l-4 border-orange-400 p-4 rounded-r-lg">
                                <h4 class="font-bold text-orange-800 mb-2">Beslenme Bilgileri:</h4>
                                <p class="text-orange-700">${pet.feedingInfo}</p>
                            </div>
                            ` : ''}
                            
                            ${pet.specialNotes ? `
                            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg">
                                <h4 class="font-bold text-yellow-800 mb-2">Ã–zel Notlar ve Dikkat Edilmesi Gerekenler:</h4>
                                <p class="text-yellow-700">${pet.specialNotes}</p>
                            </div>
                            ` : ''}
                            
                            <!-- Custom Info Boxes -->
                            ${pet.customInfoBoxes && pet.customInfoBoxes.length > 0 ? 
                                pet.customInfoBoxes.map(box => `
                                    <div class="bg-purple-50 border-l-4 border-purple-400 p-4 rounded-r-lg">
                                        <h4 class="font-bold text-purple-800 mb-2">${box.title}:</h4>
                                        <p class="text-purple-700">${box.content}</p>
                                    </div>
                                `).join('') : ''
                            }
                        </div>
                        
                        <div class="mt-8 text-center">
                            ${isPublicView ? `
                            <div class="bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-6 mb-4">
                                <h4 class="text-lg font-bold text-green-800 mb-3">ğŸ™ TeÅŸekkÃ¼r Ederiz!</h4>
                                <p class="text-green-700 mb-2">Bu kayÄ±p hayvanÄ± bulduÄŸunuz iÃ§in Ã§ok teÅŸekkÃ¼r ederiz.</p>
                                <p class="text-green-600 text-sm">LÃ¼tfen yukarÄ±daki telefon numaralarÄ±ndan sahibini arayÄ±n ve buluÅŸma noktasÄ± belirleyin.</p>
                                <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded">
                                    <p class="text-yellow-800 text-sm font-medium">âš ï¸ GÃ¼venlik iÃ§in buluÅŸmayÄ± kalabalÄ±k ve gÃ¼venli bir yerde yapÄ±n.</p>
                                </div>
                            </div>
                            ` : ''}
                            <div class="text-gray-500 text-sm">
                                <p>Bu profil ${new Date(pet.createdAt).toLocaleDateString('tr-TR')} tarihinde oluÅŸturulmuÅŸtur.</p>
                                ${isPublicView ? '<p class="mt-2 text-xs">Bu sistem NFC teknolojisi ile kayÄ±p hayvanlarÄ± sahiplerine kavuÅŸturmak iÃ§in tasarlanmÄ±ÅŸtÄ±r.</p>' : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Analytics functions
        function trackCall(phoneNumber, petId) {
            if (analytics[petId]) {
                analytics[petId].calls++;
                saveCloudData();
            }
            
            // Show call confirmation
            showCallModal(phoneNumber);
        }

        function trackLocation(petId) {
            if (analytics[petId]) {
                analytics[petId].locations++;
                
                // Get user's location if possible
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        function(position) {
                            const locationData = {
                                timestamp: new Date().toISOString(),
                                latitude: position.coords.latitude,
                                longitude: position.coords.longitude,
                                accuracy: position.coords.accuracy
                            };
                            
                            if (!analytics[petId].locationHistory) {
                                analytics[petId].locationHistory = [];
                            }
                            analytics[petId].locationHistory.push(locationData);
                            saveCloudData();
                        },
                        function(error) {
                            console.log('Konum alÄ±namadÄ±:', error);
                        }
                    );
                }
                
                saveCloudData();
            }
            
            // Show location modal
            showLocationModal();
        }

        function viewAnalytics(petId) {
            const pet = pets.find(p => p.id === petId);
            if (!pet) return;
            
            // SECURITY: Only pet owner can view analytics
            if (!currentUser || pet.userId !== currentUser.id) {
                showMessage('Bu hayvana eriÅŸim yetkiniz yok!', 'error');
                return;
            }
            
            const petAnalytics = analytics[petId] || { views: 0, calls: 0, locations: 0, viewHistory: [] };
            showAnalyticsModal(pet, petAnalytics);
        }

        function copyLink(link) {
            navigator.clipboard.writeText(link).then(() => {
                showMessage('Link kopyalandÄ±!', 'success');
            });
        }

        function showImageModal(imageSrc) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="relative max-w-4xl max-h-full">
                    <img src="${imageSrc}" class="max-w-full max-h-full object-contain rounded-lg">
                    <button onclick="this.parentElement.parentElement.remove()" class="absolute top-4 right-4 bg-white text-black rounded-full w-8 h-8 flex items-center justify-center hover:bg-gray-200 transition">&times;</button>
                </div>
            `;
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            document.body.appendChild(modal);
        }

        function updateStats() {
            // SECURITY: Only calculate stats for current user's pets
            if (!currentUser) {
                document.getElementById('totalPets').textContent = '0';
                document.getElementById('totalViews').textContent = '0';
                document.getElementById('totalCalls').textContent = '0';
                document.getElementById('totalLocations').textContent = '0';
                return;
            }
            
            const userPets = pets.filter(pet => pet.userId === currentUser.id);
            const totalViews = userPets.reduce((sum, pet) => sum + (analytics[pet.id]?.views || 0), 0);
            const totalCalls = userPets.reduce((sum, pet) => sum + (analytics[pet.id]?.calls || 0), 0);
            const totalLocations = userPets.reduce((sum, pet) => sum + (analytics[pet.id]?.locations || 0), 0);
            
            document.getElementById('totalPets').textContent = userPets.length;
            document.getElementById('totalViews').textContent = totalViews;
            document.getElementById('totalCalls').textContent = totalCalls;
            document.getElementById('totalLocations').textContent = totalLocations;
        }

        // Modal functions
        function showMessage(message, type) {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-4 py-2 rounded-lg z-50 ${type === 'error' ? 'bg-red-600' : 'bg-green-600'} text-white`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function showSuccessModal(link) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white p-6 rounded-xl max-w-md mx-4">
                    <h3 class="text-lg font-bold mb-4 text-green-600">âœ… Profil OluÅŸturuldu!</h3>
                    <p class="text-gray-600 mb-4">Hayvan profili baÅŸarÄ±yla oluÅŸturuldu. NFC tag'Ä±nÄ±za bu linki yazabilirsiniz:</p>
                    <div class="bg-gray-100 p-3 rounded-lg mb-4">
                        <code class="text-sm break-all">${link}</code>
                    </div>
                    <div class="flex space-x-4">
                        <button onclick="copyLink('${link}'); this.parentElement.parentElement.parentElement.remove();" class="flex-1 bg-purple-600 text-white py-2 rounded-lg">Linki Kopyala</button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg">Tamam</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showCallModal(phoneNumber) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white p-6 rounded-xl max-w-sm mx-4">
                    <h3 class="text-lg font-bold mb-4 text-red-600">ğŸš¨ ACÄ°L ARAMA</h3>
                    <div class="bg-red-50 border border-red-200 p-4 rounded-lg mb-4">
                        <p class="text-red-800 font-bold mb-2">KayÄ±p Hayvan Sahibini ArÄ±yorsunuz</p>
                        <p class="text-red-700 text-sm">Bu arama otomatik olarak kayÄ±t altÄ±na alÄ±nacak ve sahip bilgilendirilecektir.</p>
                    </div>
                    <p class="text-gray-600 mb-2">Aranacak numara:</p>
                    <p class="text-xl font-bold text-center mb-4 bg-gray-100 p-2 rounded">${phoneNumber}</p>
                    <div class="flex space-x-4">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg">Ä°ptal</button>
                        <button onclick="window.open('tel:${phoneNumber}'); this.parentElement.parentElement.parentElement.remove();" class="flex-1 bg-red-600 text-white py-2 rounded-lg font-bold">ğŸš¨ HEMEN ARA</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showLocationModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white p-6 rounded-xl max-w-md mx-4">
                    <h3 class="text-lg font-bold mb-4 text-orange-600">ğŸ“ Konum Sahibine GÃ¶nderildi!</h3>
                    <div class="bg-green-50 border border-green-200 p-4 rounded-lg mb-4">
                        <p class="text-green-800 font-bold mb-2">âœ… TeÅŸekkÃ¼rler!</p>
                        <p class="text-green-700 text-sm">BulduÄŸunuz konumu hayvan sahibine ilettik. Sahip artÄ±k hayvanÄ±nÄ±n nerede bulunduÄŸunu biliyor.</p>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg mb-4">
                        <p class="text-sm text-blue-700">ğŸ’¡ <strong>GÃ¼venlik:</strong> Konum bilginiz sadece hayvan sahibi tarafÄ±ndan gÃ¶rÃ¼lÃ¼r ve kayÄ±p hayvanÄ± bulmak amacÄ±yla kullanÄ±lÄ±r.</p>
                    </div>
                    <div class="bg-yellow-50 p-3 rounded-lg mb-4">
                        <p class="text-sm text-yellow-700">ğŸ“ <strong>Ã–nemli:</strong> LÃ¼tfen yukarÄ±daki telefon numaralarÄ±ndan sahibini arayarak hayvanÄ± teslim etme konusunda anlaÅŸÄ±n.</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="w-full bg-orange-600 text-white py-2 rounded-lg">AnladÄ±m</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showAnalyticsModal(pet, petAnalytics) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl max-w-2xl w-full max-h-96 overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold">${pet.name} - Analitik</h3>
                            <button onclick="this.parentElement.parentElement.parentElement.parentElement.remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="text-center p-4 bg-blue-50 rounded-lg">
                                <div class="text-2xl font-bold text-blue-600">${petAnalytics.views}</div>
                                <div class="text-sm text-gray-600">GÃ¶rÃ¼ntÃ¼lenme</div>
                            </div>
                            <div class="text-center p-4 bg-green-50 rounded-lg">
                                <div class="text-2xl font-bold text-green-600">${petAnalytics.calls}</div>
                                <div class="text-sm text-gray-600">Arama</div>
                            </div>
                            <div class="text-center p-4 bg-purple-50 rounded-lg">
                                <div class="text-2xl font-bold text-purple-600">${petAnalytics.locations}</div>
                                <div class="text-sm text-gray-600">Konum</div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-bold mb-3">Son GÃ¶rÃ¼ntÃ¼lenmeler</h4>
                            <div class="space-y-2 max-h-40 overflow-y-auto">
                                ${petAnalytics.viewHistory.slice(-10).reverse().map(view => `
                                    <div class="bg-gray-50 p-3 rounded text-sm">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="font-medium">${new Date(view.timestamp).toLocaleString('tr-TR')}</span>
                                            <span class="text-xs text-gray-500">${view.screenSize}</span>
                                        </div>
                                        <div class="text-xs text-gray-600">
                                            ${view.latitude ? `ğŸ“ Konum: ${view.latitude.toFixed(4)}, ${view.longitude.toFixed(4)}` : 'ğŸ“ Konum bilgisi yok'}
                                        </div>
                                        <div class="text-xs text-gray-500 mt-1">
                                            ${view.referrer !== 'Direkt EriÅŸim' ? `ğŸ”— ${view.referrer}` : 'ğŸ”— Direkt eriÅŸim'}
                                        </div>
                                    </div>
                                `).join('') || '<p class="text-gray-500 text-center py-4">HenÃ¼z gÃ¶rÃ¼ntÃ¼lenme yok</p>'}
                            </div>
                        </div>
                        
                        ${petAnalytics.locationHistory && petAnalytics.locationHistory.length > 0 ? `
                        <div class="mt-4">
                            <h4 class="font-bold mb-3">Konum GÃ¶rÃ¼ntÃ¼leme GeÃ§miÅŸi</h4>
                            <div class="space-y-2 max-h-32 overflow-y-auto">
                                ${petAnalytics.locationHistory.slice(-5).reverse().map(loc => `
                                    <div class="bg-green-50 p-2 rounded text-sm">
                                        <div class="flex justify-between">
                                            <span>${new Date(loc.timestamp).toLocaleString('tr-TR')}</span>
                                            <span class="text-green-600">ğŸ“ ${loc.latitude.toFixed(4)}, ${loc.longitude.toFixed(4)}</span>
                                        </div>
                                        <div class="text-xs text-gray-600">DoÄŸruluk: ${Math.round(loc.accuracy)}m</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        <div class="mt-6">
                            <p class="text-sm text-gray-600">Link: <code class="bg-gray-100 px-2 py-1 rounded">${pet.link}</code></p>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Initialize app on load
        init();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98e6b98fd58598bc',t:'MTc2MDQ0MTIxOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
